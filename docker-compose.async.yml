version: '3.8'

services:
  rabbitmq:
    image: rabbitmq:3-management
    container_name: rabbitmq-transporte
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: ${RABBITMQ_DEFAULT_USER}
      RABBITMQ_DEFAULT_PASS: ${RABBITMQ_DEFAULT_PASS}
    networks:
      - transporte-network
    restart: unless-stopped

  ms-productor-gps:
    build:
      context: ./backend/ms-productor-gps
      dockerfile: Dockerfile
    container_name: ms-productor-gps
    ports:
      - "8083:8083"
    environment:
      - SPRING_RABBITMQ_HOST=rabbitmq
      - SPRING_RABBITMQ_PORT=${SPRING_RABBITMQ_PORT}
      - SPRING_RABBITMQ_USERNAME=${SPRING_RABBITMQ_USERNAME}
      - SPRING_RABBITMQ_PASSWORD=${SPRING_RABBITMQ_PASSWORD}
    networks:
      - transporte-network
    depends_on:
      - rabbitmq
    restart: unless-stopped

  ms-productor-horarios:
    build:
      context: ./backend/ms-productor-horarios
      dockerfile: Dockerfile
    container_name: ms-productor-horarios
    ports:
      - "8084:8084"
    environment:
      - SPRING_RABBITMQ_HOST=rabbitmq
      - SPRING_RABBITMQ_PORT=${SPRING_RABBITMQ_PORT}
      - SPRING_RABBITMQ_USERNAME=${SPRING_RABBITMQ_USERNAME}
      - SPRING_RABBITMQ_PASSWORD=${SPRING_RABBITMQ_PASSWORD}
    networks:
      - transporte-network
    depends_on:
      - rabbitmq
    restart: unless-stopped

  ms-consumidor-gps:
    build:
      context: ./backend/ms-consumidor-gps
      dockerfile: Dockerfile
    container_name: ms-consumidor-gps
    ports:
      - "8085:8085"
    environment:
      - ORACLE_PASSWORD=${ORACLE_PASSWORD}
      - ORACLE_TNS_NAME=${ORACLE_TNS_NAME}
      - ORACLE_USER=${ORACLE_USER}
      - ORACLE_WALLET_PATH=${ORACLE_WALLET_PATH}
      - ORACLE_WALLET_PASSWORD=${ORACLE_WALLET_PASSWORD}
      - TNS_ADMIN=${ORACLE_WALLET_PATH}
      - SPRING_RABBITMQ_HOST=rabbitmq
      - SPRING_RABBITMQ_PORT=${SPRING_RABBITMQ_PORT}
      - SPRING_RABBITMQ_USERNAME=${SPRING_RABBITMQ_USERNAME}
      - SPRING_RABBITMQ_PASSWORD=${SPRING_RABBITMQ_PASSWORD}
    volumes:
      - ./backend/wallet/Wallet_TRANSPORTEDB:/wallet:ro
    networks:
      - transporte-network
    depends_on:
      - rabbitmq
    restart: unless-stopped

  ms-consumidor-horarios:
    build:
      context: ./backend/ms-consumidor-horarios
      dockerfile: Dockerfile
    container_name: ms-consumidor-horarios
    ports:
      - "8086:8086"
    environment:
      - SPRING_RABBITMQ_HOST=rabbitmq
      - SPRING_RABBITMQ_PORT=${SPRING_RABBITMQ_PORT}
      - SPRING_RABBITMQ_USERNAME=${SPRING_RABBITMQ_USERNAME}
      - SPRING_RABBITMQ_PASSWORD=${SPRING_RABBITMQ_PASSWORD}
      - AWS_S3_BUCKET_NAME=${AWS_S3_BUCKET_NAME}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_SESSION_TOKEN=${AWS_SESSION_TOKEN}
      - AWS_REGION=${AWS_REGION}
    networks:
      - transporte-network
    depends_on:
      - rabbitmq
    restart: unless-stopped

networks:
  transporte-network:
    driver: bridge
